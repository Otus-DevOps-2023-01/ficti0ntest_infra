#!/bin/bash

ip1=$(yc compute instances list | awk '{print $10}' | sed '/^[[:space:]]*$/d' |  sed  '1d' | head -1)
host1=$(yc compute instances list | awk '{print $4}' | sed '/^[[:space:]]*$/d' |  sed  '1d' | head -1| tr - _)
ip2=$(yc compute instances list | awk '{print $10}' | sed '/^[[:space:]]*$/d' |  sed  '1d' | tail -1)
host2=$(yc compute instances list | awk '{print $4}' | sed '/^[[:space:]]*$/d' |  sed  '1d' | tail -1| tr - _)


if [ "$1" == "--list" ] ; then
cat<<EOF
{
  "$host1": {
	"hosts": ["$ip1"]
  },
  "$host2": {
  	"hosts": ["$ip2"]
  },
  "_meta": {
	"hostvars": {
	  "$ip1": {
		"host_specific_var": "$host1"
	  },
	  "$ip2": {
		"host_specific_var": "$host2"
	  }
	}
  }
}
EOF
elif [ "$1" == "--host" ]; then
  echo '{"_meta": {"hostvars": {}}}'
else
  echo "{ }"
fi
